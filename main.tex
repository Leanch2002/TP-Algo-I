\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage[left=2.5cm,top=3cm,right=2.5cm,bottom=3cm,bindingoffset=0.5cm]{geometry}
\usepackage{AEDLogica, AEDEspecificacion, AEDTADs}
\usepackage{caratula}


\titulo{Trabajo práctico}
\subtitulo{Especificacion de TADs}

\fecha{\today}

\materia{Algoritmos y Estructuras de Datos}
\grupo{BobElConstructorPorCopia}

\integrante{Choque, Leandro}{252/25}{leandroch2002@gmail.com}
\integrante{Musi, Santino}{965/24}{santinomusi1@gmail.com}
\integrante{Rojas, Damian}{209/25}{dam.rojas1@gmail.com}
\integrante{Martell, Juan Bautista}{622/25}{Juanbamartell@hotmail.com}
% \integrante{Apellido, Nombre2}{002/01}{email2@dominio.com} %


% Declaramos donde van a estar las figuras
% No es obligatorio, pero suele ser comodo
\graphicspath{{../static/}}

% Asi pueden escribir nuevos comandos. 
% Este por ejemplo asegura q los nombres 
% que figuren con una tipografia diferenciada  
\newcommand{\Tipo}[1]{\mathsf{#1}}
% la sintaxis es \newcommand{\nombreDeLaMacro}[cantidadDeParametros]{Lo que va ser remplazado por el macro} 
\newcommand{\norm}[1]{\vert #1\vert}

% Empieza el documento
\begin{document}

\maketitle

\section{Supongo que acá iría una descripción}

Breve descripción.

Luego veremos bien el formato, esto de momento es para tener un esqueleto.

\section{Especificacion}

$Nota\ ES\ \Z$\\
$Respuesta\ ES\ Char$\\
$Examen\ ES\ \seq{Respuesta}$\\
$Coordenada\ ES\ \struct{f:\Z, c:\Z}$\\
$Alumno\ ES\ \struct{coord:Coordenada, examen:Examen}$\\
$Aula\ ES\ \seq{\seq{Alumno}}$\\
% Acá arrancamos el TAD --------------------------------------------------
\begin{tad}{EdR}

% SECCIÓN DE DUDAS/COMENTARIOS --------------------------------------------------

% Preguntar si estudiantes necesita nombre o identificación
% Preguntar por \yLuego
% Preguntar por igualdad(), si basta con '=' en arrays
% Preguntar por uso de metavariables como renombre de var interna

% RENOMBRE DE TIPOS --------------------------------------------------

% Aula: Seq[Seq[Alumno]] - Doble secuencia para representar
% Alumno: Struct {coord: Coordenada, examen: Examen}
% Coordenada: Struct{f:Z, c:Z}
% Examen: Seq[Respuesta]
% Respuesta: Char
% Nota: Z

\obs{aula}{Aula}
\\
\obs{solucion}{Examen}
\\
\obs{entregas}{\seq{Alumno}}

\section{proc EdR}
% Metodo EdR --------------------------------------------------
\begin{proc}{EdR}
{
\In dimensionAula: \Z,
\In s: Examen,
\In cantEstudiantes: \Z
}{
\Tipo{EdR}
}
    \requiereLargo{
        (dimensionAula > 0) \yLuego
    \\ rtaValida(s) \yLuego
    \\ cantValidaEstudiantes(dimensionAula, cantEstudiantes)}
    \aseguraLargo{
        (\norm{res.aula} = dimensionAula) \yLuego
    \\ aulaCuadrada(res.aula) \yLuego
    \\ noHayAlumnosJuntos(res.aula) \yLuego
    \\ (cuantosEstudiantes(res.aula) = cantEstudiantes) \yLuego
    \\ examenesSinResponder(res.aula) \yLuego
    \\ (res.solucion = s) \yLuego 
    \\ (res.entregas = \langle \rangle)
    }
\end{proc}

% True si las respuestas del examen estan en el rango de opciones
\predLargo{rtaValida}{s: Examen}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{s} \implicaLuego s[i] \in \conj{"0","1","2","3","4","5","6","7","8","9"}}
}

% True si la cantidad de estudiantes a lo sumo no hace que haya alumnos juntos
\predLargo{cantValidaEstudiantes}{a: Aula, c: \Z}{
    (c \leq ifThenElse(mod(\norm{a},2)=0, \frac{\norm{a}^ 2}{2}, \frac{\norm{a} + 1}{2} * \norm{a}))    
}

\predLargo{aulaCuadrada}{a: Aula}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{a} \implicaLuego \norm{a[i]} = \norm{a}}
}

% Ahora se fija si estan vacíos o no
\predLargo{noHayAlumnosJuntos}{a: Aula}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{a} \implicaLuego 
    \\ \paraTodo{j}{\Z}{0 \leq j < \norm{a[i]}-1 \implicaLuego (a[i][j] \neq \langle \rangle \implica a[i][j+1] = \langle \rangle)}}
}

% Tambien chequea por los vacios
\aux{cuantosEstudiantes}{a: Aula}{\Z} \\
    $\sum_{i=0}^{\norm{a}-1} \sum_{j=0}^{\norm{a[i]}-1} ifThenElse(a[i][j] \neq \langle \rangle,1,0)$
\\
\\

% CAMBIE EL PARATODO CON UNA COORDENADA AHORA
\predLargo{examenesSinResponder}{a: Aula}{
    \paraTodo{c}{Coordenada}{(coordenadaValida(c, edr.aula) \yLuego a[c.x][c.y] \neq \langle \rangle) \implicaLuego 
    \\ examenSinResponder(a[c.x][c.y].examen)}
}

% CAMBIADO A SU VERSIÓN SIN PASOS
\predLargo{examenSinResponder}{e: Examen}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{e} \implicaLuego e[i] = ""}
}

\section{proc igualdad}
% Metodo igualdad --------------------------------------------------
\begin{proc}{igualdad}
{
\In edr1,edr2: EdR,
}{
\Tipo{Bool}
}
    \requiere{True}
    \aseguraLargo{(res = True) \leftrightarrow
    \\ (edr1.aula = edr2.aula) \land
    \\ (edr1.solucion = edr2.solucion) \land
    \\ (edr1.entregas = edr2.entregas)
    }
\end{proc}

\section{proc copiarse}
% Metodo copiarse --------------------------------------------------

% CAMBIAR EL METODO COPIARSE YA QUE NO EXISTE MAS ultimoPasoExamen()

\begin{proc}{copiarse}
{
\In c1,c2: Coordenada,
\Inout edr: EdR 
}{
\Tipo{}
}
    \requiereLargo{ 
        perteneceAlumno(c1, edr.aula) \yLuego
        \\ perteneceAlumno(c2, edr.aula) \yLuego 
        \\ enRango(c1, c2, edr.aula) \yLuego
        \\ \existe{i}{\Z}{suExamen(c1, edr)[i] = "" \land suExamen(c2, edr)[i] \neq ""} \yLuego
        \\ (edr_0 = edr)
    } 
    \aseguraLargo{
        \existe{j}{\Z}{(suExamen(c1, edr_0)[j] = "" \land suExamen(c2, edr_0)[j] \neq "") \yLuego
        \\ suExamen(c1, edr) = setAt(suExamen(c1,edr_0), j, suExamen(c2, edr_0)[j])} \yLuego
        \\ todosEstudiantesIgualesMenos(\seq{c1},edr.aula,edr0.aula)\yLuego %PREGUNTAR SI ESTA SINTAXIS DE SEQ ESTÁ BIEN
        \\ (edr_0.solucion = edr.solucion) \yLuego
        \\ (edr_0.entregas = edr.entregas)
    } 
\end{proc}

% las coordenadas del alumno estan en el aula y el examen es el mismo
\predLargo{perteneceAlumno}{c:Coordenada, a:Aula}{
    (coordenadaValida(c, a) \yLuego a[c.f][c.c] \neq \langle \rangle)
}

% x e y estan entre 0 y norma del aula, por ende la coordenada es valida 
\pred{coordenadaValida}{c:Coordenada, a:Aula}{0 \leq c.f < \norm{a} \land 0 \leq c.c < \norm{a}}\\

% AHORA SE LLAMA EN RANGO PORQUE ADYACENTE SIGNIFICA OTRA COSA Y SE PUEDE MALINTERPRETAR
% las coordenadas estan dentro del aula y c0 esta a distancia |2| de c1 en x o esta directamente adelante en y
\predLargo{enRango}{c1, c2: Coordenada, a: Aula}{
    coordenadaValida(c1, a) \land coordenadaValida(c2, a) \land
    \\ ((\norm{c2.c - c1.c} = 2 \land c2.f = c1.f) \lor
    \\ (c2.c = c1.c \land  c2.f - c1.f = 1))
}

% SERIA EL REEMPLAZO DE ULTIMOPASOEXAMEN
\aux{suExamen}{c1:Coordenada, edr:EdR}{Examen} \ $edr.aula.[c1.f][c1.c].examen$


\section{proc consultarDarkWeb}
% Metodo consultarDarkWeb --------------------------------------------------
\begin{proc}{consultarDarkWeb}
{
\In s: Examen,
\In posiblesAccesos: \Z,
\Inout edr: EdR
}{}
    \requiereLargo{
    edr = edr_0 \yLuego
    \\rtaValida(s) \yLuego
    \\\norm{s} = \norm{edr.solucion} \yLuego
    \\posiblesAccesos \geq 0}
    \aseguraLargo{
    \existe {n}{\Z}{0 \leq n \leq posiblesAccesos \land 0 \leq n \leq cuantosEstudiantes(edr.aula)} \land
    \\\existe {seCopian}{seq\langle Coordenada \rangle}{\norm{seCopian} = n \yLuego \\\paraTodo{c1}{Coordenada}{c1 \in seCopian \implica \\(coordenadaValida(c1,edr.aula) \yLuego 
    edr.aula[c1.f][c1.c] \neq \langle\rangle \yLuego\\
    suExamen(c1,edr) = s)}} \yLuego
    \\edr.solucion = edr_0.solucion \yLuego
    \\edr.entregas = edr_0.entregas \yLuego
    \\todosEstudiantesIgualesMenos(seCopian,edr.aula, edr_0.aula)}
\end{proc}

\predLargo{todosEstudiantesIgualesMenos}{coords: \seq{Coordenada}, a0, a1: Aula}{
        \norm{a0} = \norm{a1}\land\\
        \paraTodo{c1}{Coordenada}{(coordenadaValida(c1, a0) \land \neg(c1 \in coords)) \implicaLuego a1[c1.f][c1.c] = a0[c1.f][c1.c]}
}

\section{proc resolver}
% Metodo resolver --------------------------------------------------

% ESTE PROC HAY QUE CAMBIARLO

\begin{proc}{resolver}
{
\Inout edr: EdR,
\In a: Alumno,
\In e: \seq{Examen}
}{
\Tipo{Examen}
}
    \requiereLargo{
    examenSinResponder(a.examen)\yLuego\\
    \norm{e} > 0 \yLuego\\
    perteneceAlumno(a, edr.aula)\yLuego\\
    edr0 = edr
    }
    \aseguraLargo{
        % vv el examen q devolvemos tiene t+1 pasos
        \norm{res} = \norm{e} + 1\yLuego\\
        % aca me aseguro que en el paso t+1 resuelvo un ejercicio que en el paso t no estaba resuelto vv
        (\exists k: \Z)(0 \leq k < \norm{e[0]} \yLuego\\
        mismosEjerciciosMenos(k, res[\norm{res}-1], e[\norm{e}-1]) \land\\
        \lnot respondio(k, e[\norm{e}-1]) \land
        respondio(k, res[\norm{res}-1]))\yLuego\\
        % vv aca me fijo que el resto de pasos esten igual
        mismosPasos(e, res) \yLuego\\
        % vv igualo el examen en edr con el examen q devuelvo
        edr.aula[a.coord.f][a.coord.c].examen = res[\norm{res}-1]\yLuego\\
        % vv Todo el resto sigue igual
        todosEstudiantesIgualesMenos(\langle a.coord \rangle, edr.aula, edr0.aula)\yLuego\\ %está bien la sintaxis de pasarle una secuencia solo con a.coord? cómo sería?
        edr0.solucion = edr.solucion \yLuego\\
        edr0.entregas = edr.entregas
    }
\end{proc}


\predLargo{hayPreguntaSinResponder}{p: Examen}{
(\exists i:\Z)(0 \leq i < \norm{p} \yLuego p[i]="")
}

\predLargo{mismosEjerciciosMenos}{i: \Z, p0, p1: Examen}{
    \norm{p1} = \norm{p0} \yLuego\\
    \paraTodo{j}{\Z}{(0 \leq j < \norm{p0} \land j \neq i)
    \implicaLuego p0[j] = p1[j]}
}

%\predLargo{mismosPasos}{e0, e1: Examen}{
%    \norm{e1} \leq \norm{e0} \yLuego\\
%    \paraTodo{j}{\Z}{0 \leq j < \norm{e0}\implicaLuego
%    \paraTodo{i}{\Z}{0 \leq i < \norm{e0[i]}}}\implicaLuego
%    e0[i][j]=e1[i][j]
%}

\predLargo{respondio}{i: \Z, p: Examen}{
    (0 \leq i < \norm{p}) \yLuego\\
    p[i]\in \conj{"0","1","2","3","4","5","6","7","8","9"}
}

\section{proc entregar}
% Metodo entregar --------------------------------------------------
\begin{proc}{entregar}
{
\In a: Alumno,
\Inout edr: EdR
}{
}
    \requiereLargo{
        (perteneceAlumno(a.coord, edr.Aula)) \yLuego
        \\ (edr = edr_0)
    } 
    \aseguraLargo{
        % CAMBIO EL a.examen, ANTES REVISABA EL ULTIMO PASO
        (edr.entregas = edr_0.entregas ++ \langle a \rangle) \yLuego
        \\ (edr.aula[a.coord.f][a.coord.c] = \langle \rangle) \yLuego
        \\ (todosEstudiantesIgualesMenos(\langle a.coord \rangle,edr,edr_0)) \yLuego
        \\ (edr.solucion = edr_0.solucion)
    }
    

\end{proc}

\section{proc chequearCopias}
% Metodo chequearCopias --------------------------------------------------
\begin{proc}{chequearCopias}
{
\In edr: EdR
}{
\Tipo{\seq{Alumno}}
}
    \requiere{True} 
    \aseguraLargo{
        \paraTodo {a_1}{Alumno}{(a_1 \in edr.entregas) \implicaLuego ((a_1 \in res) \leftrightarrow 
        \\ (\existe{a_2}{Alumno}{a_2 \in edr.entregas  \land  enRango(a_1.coord, a_2.coord, edr.aula) \land 
        \\ porcentajeRespuestasIgualAdyacente(a_1, a_2) > 60} \ \lor \\porcentajeIgualAula(a_1, edr.entregas) > 25))}
}
\end{proc}

\aux{porcentajeRespuestasIgualAdyacente}{a_1, a_2: Alumno}{\Z}
\\    $\frac{\sum_{i=0}^{\norm{a_1.examen}-1} IfThenElse(a_1.examen[i] = a_2.examen[i],1,0) \cdot 100}{\norm{a_1.examen}}$
\\

\aux{porcentajeIgualAula}{a_1:Alumno, entregas:\seq{Alumno}}{\Z}
\\    $\frac{\sum_{i=0}^{\norm{entregas}-1}IfThenElse(a_1.examen = entregas[i].examen,1,0) \cdot 100}{\norm{entregas}}$
\\
\\
\\
\\

\section{proc corregir}
% Metodo corregir --------------------------------------------------
\begin{proc}{corregir} 
{
\In edr:EdR,
\In l:\seq{Alumno}
}{
\Tipo{\seq{\tupla{Alumno, Nota}}}
}
    \requiere{True}
    \aseguraLargo{
        % Cambiar como le paso las coordenadas: \paraTodo{c}{Coordenada}{coordenadaValida(c, edr.aula)}
        \paraTodo{c}{Coordenada}{(coordenadaValida(c, edr.aula) \yLuego \neg (pertenece(edr.aula[c.x][c.y], l))) \implicaLuego
        \paraTodo{k}{\Z}{0 \leq k < \norm{res} \implicaLuego res[k] = \tupla{edr.aula[c.x][c.y], nota(edr.aula[c.x][c.y], edr.s)}}}
    }
\end{proc}

% Agregar pred pertenece y aux nota

\predLargo{pertenece}{a: Alumno, l: \seq{Alumno}}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{l} \implicaLuego l[i] = a}
}

% Suma todas las respuestas correctas, lo divide por la cantidad de respuestas y lo multiplica por 10 (standar)
\aux{nota}{a: Alumno, sol: Examen}{\Z}
    \\ $((\sum_{i=0}^{\norm{sol}}ifThenElse(a.examen[i] = sol[i], 1, 0)) \ / \ \norm{s}) \cdot 10$


\end{tad}

\end{document}
