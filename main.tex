\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage[left=2.5cm,top=3cm,right=2.5cm,bottom=3cm,bindingoffset=0.5cm]{geometry}
\usepackage{AEDLogica, AEDEspecificacion, AEDTADs}
\usepackage{caratula}


\titulo{Trabajo práctico}
\subtitulo{Especificacion de TADs}

\fecha{\today}

\materia{Algoritmos y Estructuras de Datos}
\grupo{BobElConstructorPorCopia}

\integrante{Choque, Leandro}{252/25}{leandroch2002@gmail.com}
\integrante{Musi, Santino}{965/24}{santinomusi1@gmail.com}
\integrante{Rojas, Damian}{209/25}{dam.rojas1@gmail.com}
\integrante{Martell, Juan Bautista}{622/25}{Juanbamartell@hotmail.com}
% \integrante{Apellido, Nombre2}{002/01}{email2@dominio.com} %


% Declaramos donde van a estar las figuras
% No es obligatorio, pero suele ser comodo
\graphicspath{{../static/}}

% Asi pueden escribir nuevos comandos. 
% Este por ejemplo asegura q los nombres 
% que figuren con una tipografia diferenciada  
\newcommand{\Tipo}[1]{\mathsf{#1}}
% la sintaxis es \newcommand{\nombreDeLaMacro}[cantidadDeParametros]{Lo que va ser remplazado por el macro} 
\newcommand{\norm}[1]{\vert #1\vert}

% Empieza el documento
\begin{document}

\maketitle

\section{Supongo que acá iría una descripción}

Breve descripción.

Luego veremos bien el formato, esto de momento es para tener un esqueleto.

\section{Especificacion}

% Acá arrancamos el TAD --------------------------------------------------
\begin{tad}{EdR}

% SECCIÓN DE DUDAS/COMENTARIOS --------------------------------------------------

% Preguntar si estudiantes necesita nombre o identificación
% Preguntar por \yLuego
% Preguntar por igualdad(), si basta con '=' en arrays
% Preguntar por uso de metavariables como renombre de var interna

% RENOMBRE DE TIPOS --------------------------------------------------

% Aula: Seq[Seq[Alumno]] - Doble secuencia para representar
% Alumno: Struct {coord: Coordenada, examen: Examen}
% Coordenada: Struct{f:Z, c:Z}
% Examen: seq[Paso]
% Paso = Seq[Respuesta]
% Respuesta: Char
% Nota: Z

\obs{aula}{Aula}
\\
\obs{solucion}{Paso}
\\
\obs{entregas}{\seq{\tupla{Coordenada, Paso}}}
\\
\\

% Metodo EdR --------------------------------------------------
\begin{proc}{EdR}
{
\In dimensionAula: \Z,
\In s: Paso,
\In cantEstudiantes: \Z
}{
\Tipo{EdR}
}
    \requiereLargo{
        (dimensionAula > 0) \yLuego
    \\ rtaValida(s) \yLuego
    \\ cantValidaEstudiantes(dimensionAula, cantEstudiantes)}
    \aseguraLargo{
        (\norm{res.aula} = dimensionAula) \yLuego
    \\ aulaCuadrada(res.aula) \yLuego
    \\ noHayAlumnosJuntos(res.aula) \yLuego
    \\ (cuantosEstudiantes(res.aula) = cantEstudiantes) \yLuego
    \\ examenesSinResponder(res.aula) \yLuego
    \\ (res.solucion = s) \yLuego 
    \\ (res.entregas = \langle \rangle)
    }
\end{proc}

% True si las respuestas del paso estan en el rango de opciones
\predLargo{rtaValida}{s: Paso}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{s} \implicaLuego s[i] \in \conj{"0","1","2","3","4","5","6","7","8","9"}}
}

% True si la cantidad de estudiantes a lo sumo no hace que haya alumnos juntos
\predLargo{cantValidaEstudiantes}{a: Aula, e: \Z}{
    (e \leq ifThenElse(mod(\norm{a},2)==0, \frac{\norm{a}^ 2}{2}, \frac{\norm{a} + 1}{2} * \norm{a}))    
}

\predLargo{aulaCuadrada}{a: Aula}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{a} \implicaLuego \norm{a[i]} = \norm{a}}
}

% Ahora se fija si estan vacíos o no
\predLargo{noHayAlumnosJuntos}{a: Aula}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{a} \implicaLuego 
    \\ \paraTodo{j}{\Z}{0 \leq j < \norm{a[i]}-1 \implicaLuego (a[i][j] \neq \langle \rangle \implica a[i][j+1] = \langle \rangle)}}
}

% Tambien chequea por los vacios
\aux{cuantosEstudiantes}{a: Aula}{\Z} \\
    $\sum_{i=0}^{\norm{a}-1} \sum_{j=0}^{\norm{a[i]}-1} ifThenElse(a[i][j] \neq \langle \rangle,1,0)$
\\
\\
\predLargo{examenesSinResponder}{a: Aula}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{a} \implicaLuego \paraTodo{j}{\Z}{0 \leq j < \norm{a[i]} \land a[i][j] \neq <> \implicaLuego \\ examenSinResponder(a[i][j].examen)}}
}

% Es el complemento del pred de arriba, se fija que haya 1 paso solo de examen y que todas sus respuestas sean ""
\predLargo{examenSinResponder}{e: Examen}{
    (\norm{e} = 1 \land \paraTodo{i}{\Z}{0 \leq i < \norm{e[0]} \implica e[0][i] = ""})
    % agregue lo de |e| = 0 porque sino da false cuando no hay examen
    % CHEQUEAR: PARA MI HAY QUE VER SI, HABIENDO UN EXAMEN, ES VACÍO. SI NO HAY EXAMEN ES OTRO ASUNTO.
}

% Metodo igualdad --------------------------------------------------
\begin{proc}{igualdad}
{
\In edr1,edr2: EdR,
}{
\Tipo{Bool}
}
    \requiere{True}
    \aseguraLargo{(res = True) \leftrightarrow
    \\ (edr1.aula = edr2.aula) \land
    \\ (edr1.solucion = edr2.solucion) \land
    \\ (edr1.entregas = edr2.entregas)
    }
\end{proc}

% Metodo copiarse --------------------------------------------------
\begin{proc}{copiarse}
{
\In c1, c2: Coordenada,
\Inout edr: EdR 
}{
\Tipo{}
}
    \requiereLargo{ 
        perteneceAlumno(c1, edr.aula) \yLuego
        \\ perteneceAlumno(c2, edr.aula) \yLuego
        \\ edr = edr0 \yLuego
        \\ adyacentes(c1, c2, edr.aula) \yLuego
        \\(\exists k:\Z)(ultimoPasoExamen(c1, edr) = "" \land ultimoPasoExamen(c2, edr) \neq "")
        %(\exists k:\Z)(edr[c1.f][c1.c][\norm{edr[c1.f][c1.c]}-1][k] = "" \land edr[c2.f][c2.c][\norm{edr[c2.f][c2.c]}-1][k] \neq "")
        } 
    \aseguraLargo{
    \norm{edr.aula[c1.f][c1.c]} = \norm{edr0.aula[c1.f][c1.c]} + 1 \yLuego
    \\ (\exists j:\Z)(ultimoPasoExamen(c1,edr0)[j] = "" \ \land \ ultimoPasoExamen(c2,edr0)[j] \neq "" \ \land \ ultimoPasoExamen(c1,edr) =
    \\ setAt(ultimoPasoExamen(c1,edr0),j,ultimoPasoExamen(c2,edr0)[j])) \yLuego
    %(\exists j:\Z)((edr[c1.f][c1.c][\norm{edr[c1.f][c1.c]}-2][j] = edr[c2.f][c2.c][\norm{edr[c2.f][c1.2]}-1][j] ) \land (edr[c1.f][c1.c][\norm{edr[c1.f][c1.c]}-2][j] = "")) \yLuego
    % \paraTodo m \Z {(0 \leq m <\norm{edr[c1.f][c1.c]}  \land  m \neq j) \implicaLuego edr[\norm{a1.examen}-1][m] = edr0.Aula[a1.coord.f][a1.coord.c][\norm{a1.examen}-1][m]} \yLuego
    \\ \paraTodo {c3}{Coordenada}{(coordenadaValida(c3, edr0.Aula) \land c1.f \neq c3.f \lor c1.c \neq c3.c) \implicaLuego edr.Aula[c3.f][c3.c] = edr0.Aula[c3.f][c3.c]} \yLuego
    % el resto esta igual
    \\ edr0.solucion = edr.solucion \yLuego 
    \\ edr0.entregas = edr.entregas
    } 
\end{proc}

% las coordenadas del alumno estan en el aula y el examen es el mismo
\predLargo{perteneceAlumno}{c:Coordenada, a:Aula}{
    (coordenadaValida(c, edr.aula) \yLuego
    \\ a[c.f][c.c] \neq \langle \rangle)
}

% x e y estan entre 0 y norma del aula, por ende la coordenada es valida 
\pred{coordenadaValida}{c:Coordenada, a:Aula}{0 \leq c.f < \norm{a} \land 0 \leq c.c < \norm{a}}\\

% las coordenadas estan dentro del aula y c0 esta a distancia |2| de c1 en x o esta directamente adelante en y
\predLargo{adyacentes}{c1, c2: Coordenada, a: Aula}{
    coordenadaValida(c1, a) \land coordenadaValida(c2, a) \land
    \\ ((\norm{c2.c - c1.c} = 2 \land c2.f = c1.f) \lor
    \\ (c2.c = c1.c \land  c2.f - c1.f = 1))
} 

\aux{ultimoPasoExamen}{c:Coordenada, edr:EdR}{Examen} \\ $ edr.aula[c.f][c.c].examen[\norm{examen}-1]$ \\

% Metodo publicarResolucion --------------------------------------------------
\begin{proc}{consultarDarkWeb}
{
\In s: Paso,
\In posiblesAccesos: \Z,
\Inout edr: EdR
}{}
    \requiereLargo{
    edr = edr0 \yLuego
    \\rtaValida(s) \yLuego
    \\\norm{s} = \norm{edr.solucion}
    \\posiblesAccesos \geq 0}
    \aseguraLargo{
    \existe {n}{\Z}{0 \leq n \leq posiblesAccesos \land 0 \leq n \leq cuantosEstudiantes(edr.aula)} \implica
    \\(\paraTodo {i}{\Z}{0 \leq i \leq n} \implicaLuego \existe {c_i}{Coordenada}{coordenadaValida(c_i,edr.aula) \land edr.aula[c_i.f][c_i.c] \neq <>} \implicaLuego
    concat(edr.aula[c_i.f][c_i.c].examen,s)) \yLuego %está bien el concat?
    \\edr.solucion = edr0.solucion \yLuego
    \\edr.entregas = edr0.entregas}
\end{proc}

% Metodo resolver --------------------------------------------------
\begin{proc}{resolver}
{
\Inout edr: EdR,
\In a: Alumno
}{
\Tipo{Examen}
}
    \requiereLargo{
    perteneceAlumno(a, edr.aula) \yLuego\\
    hayPreguntaSinResponder(ultimoPasoExamen(a.coord, edr)) \yLuego\\
    edr0 = edr
    }
    \aseguraLargo{
        % vv el examen q devolvemos tiene t+1 pasos
        \norm{res} = \norm{a.examen} + 1\yLuego\\
        % aca me aseguro que en el paso t+1 resuelvo un ejercicio que en el paso t no estaba resuelto vv
        (\exists k: \Z)(0 \leq k < \norm{a.examen[0]} \yLuego\\
        mismosEjerciciosMenos(k, res[-1], a.examen[-1]) \land\\
        \lnot respondio(k, a.examen[-1]) \land
        respondio(k, res[-1]))\yLuego\\
        % vv aca me fijo que el resto de pasos esten igual
        mismosPasos(a.examen, res) \yLuego\\
        % vv igualo el examen en edr con el examen q devuelvo
        edr.aula[a.coord.f][a.coord.c].examen = res\yLuego\\
        % vv Todo el resto sigue igual
        todosEstudiantesIgualesMenos(a.coord, edr.aula, edr0.aula)\yLuego\\
        edr0.solucion = edr.solucion \yLuego\\
        edr0.entregas = edr.entregas
    }
\end{proc}


\predLargo{hayPreguntaSinResponder}{p: Paso}{
(\exists i:\Z)(0 \leq i < \norm{p} \yLuego p[i]="")
}

\predLargo{mismosEjerciciosMenos}{i: \Z, p0, p1: Paso}{
    \norm{p1} = \norm{p0} \yLuego\\
    \paraTodo{j}{\Z}{(0 \leq j < \norm{p0} \land j \neq i)
    \implicaLuego p0[j] = p1[j]}
}

\predLargo{mismosPasos}{e0, e1: Examen}{
    \norm{e1} \leq \norm{e0} \yLuego\\
    \paraTodo{j}{\Z}{0 \leq j < \norm{e0}\implicaLuego
    \paraTodo{i}{\Z}{0 \leq i < \norm{e0[i]}}}\implicaLuego
    e0[i][j]=e1[i][j]
}

\predLargo{respondio}{i: \Z, p: Paso}{
    (0 \leq i < \norm{p}) \yLuego\\
    p[i]\in \conj{"0","1","2","3","4","5","6","7","8","9"}
}

\predLargo{todosEstudiantesIgualesMenos}{c: Coordenada, a0, a1: Aula}{
        aulaCuadrada(a0)\land aulaCuadrada(a1)\land\\
        \norm{a0} = \norm{a1}\land\\
        \paraTodo{c}{Coordenada}{(coordenadaValida(c, a0) \land c \neq e) \implicaLuego a1[c.f][c.c] = a0[c.f][c.c]}
}

% Metodo entregar --------------------------------------------------
\begin{proc}{entregar}
{
\In a: Alumno,
\Inout edr: EdR
}{
}
    \requiereLargo{
        perteneceAlumno(a.coord, edr.Aula) \yLuego
        \\ edr = edr0
    } 
    \aseguraLargo{
        edr.entregas = edr0.entregas ++ \tupla{a.coord, a.examen[\norm{a.examen}-1]} \land
        \\ edr.aula[a.coord.f][a.coord.c] = \langle \rangle \land
        \\ \paraTodo {c1}{Coordenada} {coordenadaValida(c1, edr.aula) \yLuego c1 \neq a.coord \implicaLuego edr.aula[c1.f][c1.c] = edr0.aula[c1.f][c1.c]} \yLuego
        \\ edr.solucion = edr0.solucion
        }
    

\end{proc}

% Metodo chequearCopias --------------------------------------------------
\begin{proc}{chequearCopias}
{
\In alumnos: seq<Alumno> % Creo que no recibe nada o recibe un EdR
}{
\Tipo{seq<Alumno>}
}
    \requiere{True} % Si no recibe nada va True, a lo mejor recibe un EdR pero entonces también iría True, mientras sea un EdR válido sirve
    \asegura{res} % Acá hay que ver cómo poner lo de propoción de rtas equivalentes a compañero cercano >60% y eso, cómo medirlo, o eso sería muy implementativo?
    % Quedaría tipo, para todo alumno en aula, si esSimilarACercano(aula[i][j].examen) o esSimilarAAlumnado(aula[i][j].examen) entonces se concatena a la secuencia
\end{proc}

% Metodo corregir --------------------------------------------------
\begin{proc}{corregir} 
{
\In edr:EdR,
\In l:\seq{Alumno}
}{
\Tipo{\seq{\tupla{Alumno, Nota}}}
}
    \requiere{True}
    \aseguraLargo{
        % Cambiar como le paso las coordenadas: \paraTodo{c}{Coordenada}{coordenadaValida(c, edr.aula)}
        \paraTodo{i, j}{\Z}{(coordenadaValida(i, j, edr.Aula) \yLuego \neg (pertenece(edr[i][j], l))) \implicaLuego
        \\ \paraTodo{k}{\Z}{0 \leq k < \norm{res} \implicaLuego res[k] = \tupla{edr[i][j], nota(edr[i][j], edr.s])}}}
        }
\end{proc}

% Agregar pred pertenece y pred nota

\end{tad}

\end{document}
