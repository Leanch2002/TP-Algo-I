\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage[left=2.5cm,top=3cm,right=2.5cm,bottom=3cm,bindingoffset=0.5cm]{geometry}
\usepackage{AEDLogica, AEDEspecificacion, AEDTADs}
\usepackage{caratula}


\titulo{Trabajo práctico N°1}
\subtitulo{Especificacion de TADs}

\fecha{\today}

\materia{Algoritmos y Estructuras de Datos}
\grupo{BobElConstructorPorCopia}

\integrante{Choque, Leandro}{252/25}{leandroch2002@gmail.com}
\integrante{Musi, Santino}{965/24}{santinomusi1@gmail.com}
\integrante{Rojas, Damian}{209/25}{dam.rojas1@gmail.com}
\integrante{Martell, Juan Bautista}{622/25}{juanbamartell@hotmail.com}
% \integrante{Apellido, Nombre2}{002/01}{email2@dominio.com} %


% Declaramos donde van a estar las figuras
% No es obligatorio, pero suele ser comodo
\graphicspath{{../static/}}

% Asi pueden escribir nuevos comandos. 
% Este por ejemplo asegura q los nombres 
% que figuren con una tipografia diferenciada  
\newcommand{\Tipo}[1]{\mathsf{#1}}
% la sintaxis es \newcommand{\nombreDeLaMacro}[cantidadDeParametros]{Lo que va ser remplazado por el macro} 
\newcommand{\norm}[1]{\vert #1\vert}

% Empieza el documento
\begin{document}

\maketitle

\section{Aclaraciones}

En proc chequearCopias, en el aux porcentajeRespuestasIgualAdyacente aseguramos que se cuenten las respuestas vacías como coincidencias, debido a la aclaración de uno de los profesores, y en aux porcentajeIgualAula comparamos el examen entero con el \textbf{resto} del alumnado según lo especificado en la consigna.

\section{Especificacion}

$Nota\ ES\ \Z$\\
$Respuesta\ ES\ Char$\\
$Examen\ ES\ \seq{Respuesta}$\\
$Coordenada\ ES\ struct\struct{f:\Z, c:\Z}$\\
$Alumno\ ES\ struct\struct{coord:Coordenada, examen:Examen}$\\
$Aula\ ES\ \seq{\seq{Alumno}}$\\
\\
% Acá arrancamos el TAD --------------------------------------------------
\begin{tad}{EdR}

% SECCIÓN DE DUDAS/COMENTARIOS --------

% RENOMBRE DE TIPOS --------------------------------------------------

% Aula: Seq[Seq[Alumno]] - Doble secuencia para representar
% Alumno: Struct {coord: Coordenada, examen: Examen}
% Coordenada: Struct{f:Z, c:Z}
% Examen: Seq[Respuesta]
% Respuesta: Char
% Nota: Z

\obs{aula}{Aula}
\\
\obs{solucion}{Examen}
\\
\obs{entregas}{\conj{Alumno}}
\\
\obs{copiones}{\conj{Alumno}}
\subsection{proc EdR}
% Metodo EdR --------------------------------------------------
\begin{proc}{EdR}
{
\In dimensionAula: \Z,
\In s: Examen,
\In cantEstudiantes: \Z
}{
\Tipo{EdR}
}
    \requiereLargo{
    dimensionAula > 0 \yLuego
    \\ rtaValida(s) \yLuego
    \\ cantValidaEstudiantes(dimensionAula, cantEstudiantes)}
    \aseguraLargo{
    \norm{res.aula} = dimensionAula \yLuego
    \\ \paraTodo{c1}{Coordenada}{(coordenadaValida(c1,res.aula) \yLuego res.aula[c1.f][c1.c] \neq \langle \rangle) \implicaLuego (edr.aula[c1.f][c1.c].coord.f = f \land edr.aula[c1.f][c1.c].coord.c = c)} \yLuego
    \\ aulaCuadrada(res.aula) \yLuego
    \\ noHayAlumnosJuntos(res.aula) \yLuego
    \\ cuantosEstudiantes(res.aula) = cantEstudiantes \yLuego
    \\ examenesInicializados(res.aula, s) \yLuego
    \\ res.solucion = s \yLuego 
    \\ res.entregas = \conj{}
    \\ res.copiones = \conj{}
    }
\end{proc}

% Las respuestas del examen estan en el rango de opciones
\predLargo{rtaValida}{s: Examen}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{s} \implicaLuego s[i] \in \conj{"0","1","2","3","4","5","6","7","8","9"}}
}

% si c y f estan entre las dimensiones de aula la coordenada es valida 
\predLargo{coordenadaValida}{c:Coordenada, a:Aula}{0 \leq c.f < \norm{a} \land 0 \leq c.c < \norm{a}}

% La cantidad de estudiantes a lo sumo no hace que haya alumnos juntos
\predLargo{cantValidaEstudiantes}{a, c: \Z}{
    (c \leq ifThenElse(mod(a,2)=0, \frac{a^ 2}{2}, \frac{a + 1}{2} * a))    
}

% el aula tiene misma cantidad de filas y columnas
\predLargo{aulaCuadrada}{a: Aula}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{a} \implicaLuego \norm{a[i]} = \norm{a}}
}

% si hay un alumno en el asiento entonces, el que le sigue tiene que ser vacio
\predLargo{noHayAlumnosJuntos}{a: Aula}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{a} \implicaLuego 
    \\ \paraTodo{j}{\Z}{0 \leq j < \norm{a[i]}-1 \implicaLuego (a[i][j] \neq \langle \rangle \implica a[i][j+1] = \langle \rangle)}}
}

% cuantos estudiantes hay en el aula
\aux{cuantosEstudiantes}{a: Aula}{\Z} \\
    $\sum_{i=0}^{\norm{a}-1} \sum_{j=0}^{\norm{a[i]}-1} ifThenElse(a[i][j] \neq \langle \rangle,1,0)$
\\
\\

% todos los examenes en el aula estan sin responder y son del largo correcto
\predLargo{examenesInicializados}{a: Aula, sol: Examen}{
    \paraTodo{c1}{Coordenada}{(coordenadaValida(c1, a) \yLuego a[c1.f][c1.c] \neq \langle \rangle) \implicaLuego 
    \\ examenInicializado(a[c1.f][c1.c].examen, sol)}
}

% El examen no tiene ninguna respuesta
\predLargo{examenInicializado}{e: Examen, sol: Examen}{
    \norm{e} = \norm{sol} \yLuego
    \paraTodo{i}{\Z}{0 \leq i < \norm{e} \implicaLuego e[i] = ""}
}

\subsection{proc igualdad}
% Metodo igualdad --------------------------------------------------
\begin{proc}{igualdad}
{
\In edr_1,edr_2: EdR,
}{
\Tipo{Bool}
}
    \requiere{True}
    \aseguraLargo{res = True \leftrightarrow
    \\ (edr_1.aula = edr_2.aula \land
    \\ edr_1.solucion = edr_2.solucion \land
    \\ edr_1.entregas = edr_2.entregas \land
    \\ edr_1.copiones = edr_2.copiones)
    }
\end{proc}

\subsection{proc copiarse}
% Metodo copiarse --------------------------------------------------

% CAMBIAR EL METODO COPIARSE YA QUE NO EXISTE MAS ultimoPasoExamen()

\begin{proc}{copiarse}
{
\In a1: Alumno,
\Inout edr: EdR 
}{
\Tipo{}
}
    \requiereLargo{ 
        perteneceAlumno(a1, edr.aula) \yLuego
        \\ \existe{a2}{Alumno}{ perteneceAlumno(a2, edr.aula)\ \yLuego\ enRango(a1.coord, a2.coord, edr.aula) \yLuego 
        \existe{i}{\Z}{a1.examen[i] = "" \land a2.examen[i] \neq ""}} \yLuego
        \\ (edr_0 = edr)
    } 
    \aseguraLargo{
        \existe{a3}{Alumno}{perteneceAlumno(a3, edr_0.aula) \yLuego enRango(a1.coord, a3.coord, edr_0.aula) \yLuego 
        \existe{j}{\Z}{suExamen(a1.coord, edr_0)[j]= "" \land \\
        suExamen(a3.coord, edr_0)[j] \neq ""}\land \\
        (suExamen(a1.coord, edr)[j] = suExamen(a3.coord, edr)[j]) \land\\
        mismosEjerciciosMenos(j, suExamen(a1.coord, edr), suExamen(a1.coord, edr_0))} \yLuego
        todosEstudiantesIgualesMenos(\langle a1.coord \rangle ,edr.aula,edr0.aula)\yLuego 
        \\ (edr_0.solucion = edr.solucion) \yLuego
        \\ (edr_0.entregas = edr.entregas) \yLuego
        \\ (edr_0.copiones = edr.copiones) \yLuego
        \\ mismasDimensiones(edr.aula,edr_0.aula)
    } 
\end{proc}
\\

\predLargo{mismasDimensiones}{a1,a2: Aula}{
    \norm{a1}=\norm{a2}
}

\predLargo{todosEstudiantesIgualesMenos}{coords: \seq{Coordenada}, a0, a1: Aula}{
        \norm{a0} = \norm{a1}\land\\ 
        \paraTodo{c1}{Coordenada}{(coordenadaValida(c1, a0) \land \neg(c1 \in coords)) \implicaLuego a1[c1.f][c1.c] = a0[c1.f][c1.c]}
}

\predLargo{mismosEjerciciosMenos}{i: \Z, e0, e1: Examen}{
    \norm{e1} = \norm{e0} \yLuego\\
    \paraTodo{j}{\Z}{(0 \leq j < \norm{e0} \land j \neq i)
    \implicaLuego e0[j] = e1[j]}
}
% las coordenadas del alumno estan en el aula y el examen es el mismo

\predLargo{perteneceAlumno}{e: Alumno, a:Aula}{
    (coordenadaValida(e.coord, a) \yLuego a[e.coord.f][e.coord.c] \neq \langle \rangle \yLuego\\
    a[e.coord.f][e.coord.c].examen = e.examen)
}

% las coordenadas estan dentro del aula y c0 esta a distancia |2| de c1 en x o esta directamente adelante en y
\predLargo{enRango}{c1, c2: Coordenada, a: Aula}{
    coordenadaValida(c1, a) \land coordenadaValida(c2, a) \land
    \\ ((\norm{c2.c - c1.c} = 2 \land c2.f = c1.f) \lor
    \\ (c2.c = c1.c \land  c2.f - c1.f = 1))
}

% devuelve el examen del alumno en c1
\aux{suExamen}{c1:Coordenada, edr:EdR}{Examen} \ $edr.aula.[c1.f][c1.c].examen$


\subsection{proc consultarDarkWeb}
% Metodo consultarDarkWeb --------------------------------------------------
\begin{proc}{consultarDarkWeb}
{
\In s: Examen,
\In posiblesAccesos: \Z,
\Inout edr: EdR
}{}
    \requiereLargo{
    edr = edr_0 \yLuego
    \\rtaValida(s) \yLuego
    \\\norm{s} = \norm{edr.solucion} \yLuego
    \\posiblesAccesos \geq 0}
    \aseguraLargo{
    \existe {n}{\Z}{0 \leq n \leq posiblesAccesos \land 0 \leq n \leq cuantosEstudiantes(edr.aula)} \land
    \\\existe {seCopian}{seq\langle Coordenada \rangle}{\norm{seCopian} = n \yLuego \\\paraTodo{c1}{Coordenada}{c1 \in seCopian \implica \\(coordenadaValida(c1,edr.aula) \yLuego 
    edr.aula[c1.f][c1.c] \neq \langle\rangle \yLuego\\
    suExamen(c1,edr) = s)}} \yLuego
    \\todosEstudiantesIgualesMenos(seCopian,edr.aula, edr_0.aula) \yLuego
    \\edr.solucion = edr_0.solucion \yLuego
    \\edr.entregas = edr_0.entregas \yLuego
    \\edr.copiones = edr_0.copiones \yLuego
    \\mismasDimensiones(edr.aula,edr_0.aula)
}
\end{proc}
\\ \\ \\
% si las 2 aulas comparten dimension -> todos los alumnos menos los que estan en la secuencia coords son el mismo
\subsection{proc resolver}
% Metodo resolver --------------------------------------------------
\begin{proc}{resolver}
{
\Inout edr: EdR,
\In a: Alumno,
\In e: \seq{Examen}
}{
\Tipo{\seq{Examen}}
}
    \requiereLargo{
    perteneceAlumno(a, edr.aula)\yLuego\\
    examenInicializado(a.examen, edr.solucion)\yLuego\\
    \norm{e} > 0 \yLuego\\
    edr0 = edr
    }
    \aseguraLargo{
        % vv el examen q devolvemos tiene t+1 pasos
        \norm{res} = \norm{e} + 1\yLuego\\
        % aca me aseguro que en el paso t+1 resuelvo un ejercicio que en el paso t no estaba resuelto vv
        (\exists k: \Z)(0 \leq k < \norm{e[0]} \yLuego\\
        mismosEjerciciosMenos(k, res[\norm{res}-1], e[\norm{e}-1]) \land\\
        \lnot respondio(k, e[\norm{e}-1]) \land
        respondio(k, res[\norm{res}-1]))\yLuego\\
        % vv aca me fijo que el resto de pasos esten igual
        mismosPasos(res, e) \yLuego\\
        % vv igualo el examen en edr con el examen q devuelvo
        edr.aula[a.coord.f][a.coord.c].examen = res[\norm{res}-1]\yLuego\\
        % vv Todo el resto sigue igual
        todosEstudiantesIgualesMenos(\langle a.coord \rangle, edr.aula, edr0.aula)\yLuego\\ %está bien la sintaxis de pasarle una secuencia solo con a.coord? cómo sería?
        edr_0.solucion = edr.solucion \yLuego\\
        edr_0.entregas = edr.entregas \yLuego\\
        edr_0.copiones = edr.copiones \yLuego
        \\mismasDimensiones(edr.aula,edr_0.aula)
    }
\end{proc}

% Existe al menos una pregunta no resuelta en e
%\predLargo{hayPreguntaSinResponder}{e: Examen}{
%(\exists i:\Z)(0 \leq i < \norm{e} \yLuego e[i]="")
%}
% todos los pasos en p0 y p1 son iguales menos los ultimos en p0

\predLargo{mismosPasos}{p0, p1: \seq{Examen}}{
   \norm{p1} \leq \norm{p0} \yLuego\\
   \paraTodo{j}{\Z}{0 \leq j < \norm{p0}\implicaLuego
   \paraTodo{i}{\Z}{0 \leq i < \norm{p0[i]}}}\implicaLuego
   p0[i][j]=p1[i][j]
}

% i es un indice de examen y el valor del examen en i es una respuesta valida
\predLargo{respondio}{i: \Z, e: Examen}{
    (0 \leq i < \norm{e}) \yLuego\\
    e[i]\in \conj{"0","1","2","3","4","5","6","7","8","9"}
}

\subsection{proc entregar}
% Metodo entregar --------------------------------------------------
\begin{proc}{entregar}
{
\In a: Alumno,
\Inout edr: EdR
}{
}
    \requiereLargo{
        (perteneceAlumno(a, edr.Aula)) \yLuego
        \\ (edr = edr_0)
    } 
    \aseguraLargo{
        % CAMBIO EL a.examen, ANTES REVISABA EL ULTIMO PASO
        (edr.entregas = edr_0.entregas \cup \conj{a}) \yLuego
        \\ (edr.aula[a.coord.f][a.coord.c] = \langle \rangle) \yLuego
        \\ (todosEstudiantesIgualesMenos(\langle a.coord \rangle,edr,edr_0)) \yLuego
        \\ (edr.solucion = edr_0.solucion) \yLuego
        \\ (edr.copiones = edr_0.copiones) \yLuego
    \\mismasDimensiones(edr.aula,edr_0.aula)
    }
\end{proc}

\subsection{proc chequearCopias}
% Metodo chequearCopias --------------------------------------------------
\begin{proc}{chequearCopias}
{
\In edr: EdR
}{
\Tipo{\seq{Alumno}}
}
    \requiere{todosEntregaron(edr)} 
    \aseguraLargo{
        \paraTodo {a1}{Alumno}{(a1 \in edr.entregas) \implicaLuego ((a1 \in res) \leftrightarrow 
        \\ (\existe{a2}{Alumno}{a2 \in edr.entregas  \land  enRango(a1.coord, a2.coord, edr.aula) \land 
        \\ porcentajeRespuestasIgualAdyacente(a1, a2) > 60} \ \lor \\porcentajeIgualAula(a1, edr.entregas) > 25))}
        \\ \norm{edr.copiones} = \norm{res} \yLuego
        \\ \paraTodo{a3}{Alumno}{a3 \in edr.copiones \leftrightarrow a3 \in res}
        }
\end{proc}

% devuelve el porcentaje de respuestas iguales entre 2 alumnos
\aux{porcentajeRespuestasIgualAdyacente}{a1, a2: Alumno}{\Z}
\\    $(\sum_{i=0}^{\norm{a1.examen}-1} IfThenElse((a1.examen[i] = a2.examen[i]),1,0)) \cdot \frac{100}{\norm{a1.examen}}$
\\

% devuelve el porcentaje de alumnos que tienen el mismo examen que a1 en una secuencia
\aux{porcentajeIgualAula}{a1:Alumno, entregas:\conj{Alumno}}{\Z}
\\ $(\sum_{i \in entregas}IfThenElse(a1.examen = i.examen,1,0)) \cdot \frac{100}{\norm{entregas}-1}$
\\

\predLargo{todosEntregaron}{edr: EdR}{
    \norm{edr.entregas} > 0 \land
    \\\paraTodo{c1}{Coordenada}{coordenadaValida(c1,edr.aula) \implicaLuego edr.aula[c1.f][c1.c]=\langle \rangle}
}

\subsection{proc corregir}
% Metodo corregir --------------------------------------------------
\begin{proc}{corregir} 
{
\In edr:EdR
}{
\Tipo{\seq{tupla\tupla{Alumno, Nota}}}
}
    \requiere{todosEntregaron(edr)}
    \aseguraLargo{
        \paraTodo{a}{Alumno}{(a \in edr.entregas \land \lnot (a \in edr.copiones)) \implicaLuego
        \\ (tupla\tupla{a, nota(a, edr.solucion)} \in res)}
}
\end{proc}

% Suma todas las respuestas correctas, lo divide por la cantidad de respuestas y lo multiplica por 10 (standar)
\aux{nota}{a: Alumno, sol: Examen}{\Z}
    \\ $((\sum_{i=0}^{\norm{sol}-1}ifThenElse(a.examen[i] = sol[i], 1, 0))) \cdot \frac{10}{\norm{sol}}$

\end{tad}

\end{document}
