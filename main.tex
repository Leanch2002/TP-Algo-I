\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage[left=2.5cm,top=3cm,right=2.5cm,bottom=3cm,bindingoffset=0.5cm]{geometry}
\usepackage{AEDLogica, AEDEspecificacion, AEDTADs}
\usepackage{caratula}


\titulo{Trabajo práctico N°1}
\subtitulo{Especificacion de TADs}

\fecha{\today}

\materia{Algoritmos y Estructuras de Datos}
\grupo{BobElConstructorPorCopia}

\integrante{Choque, Leandro}{252/25}{leandroch2002@gmail.com}
\integrante{Musi, Santino}{965/24}{santinomusi1@gmail.com}
\integrante{Rojas, Damian}{209/25}{dam.rojas1@gmail.com}
\integrante{Martell, Juan Bautista}{622/25}{juanbamartell@hotmail.com}
% \integrante{Apellido, Nombre2}{002/01}{email2@dominio.com} %


% Declaramos donde van a estar las figuras
% No es obligatorio, pero suele ser comodo
\graphicspath{{../static/}}

% Asi pueden escribir nuevos comandos. 
% Este por ejemplo asegura q los nombres 
% que figuren con una tipografia diferenciada  
\newcommand{\Tipo}[1]{\mathsf{#1}}
% la sintaxis es \newcommand{\nombreDeLaMacro}[cantidadDeParametros]{Lo que va ser remplazado por el macro} 
\newcommand{\norm}[1]{\vert #1\vert}

% Empieza el documento
\begin{document}

\maketitle

\section{Aclaraciones}

Tomamos un asiento vacío en el aula como un struct Alumno con examen = $\seq{}$.\\

En proc \textit{chequearCopias}, en el aux \textit{porcentajeRespuestasIgualAdyacente} aseguramos que se cuenten las respuestas vacías como coincidencias, debido a la aclaración de uno de los profesores, y en aux porcentajeIgualAula comparamos el examen entero con el \textbf{resto} del alumnado según lo especificado en la consigna.

\section{Especificacion}

$Nota\ ES\ \R$\\
$Respuesta\ ES\ \Z$\\
$Examen\ ES\ \seq{Respuesta}$\\
$Coordenada\ ES\ struct\struct{f:\Z, c:\Z}$\\
$Alumno\ ES\ struct\struct{coord:Coordenada, examen:Examen}$\\
$Aula\ ES\ \seq{\seq{Alumno}}$\\
\\
% Acá arrancamos el TAD --------------------------------------------------
\begin{tad}{EdR}

% SECCIÓN DE DUDAS/COMENTARIOS --------

% RENOMBRE DE TIPOS --------------------------------------------------

% Aula: Seq[Seq[Alumno]] - Doble secuencia para representar
% Alumno: Struct {coord: Coordenada, examen: Examen}
% Coordenada: Struct{f:Z, c:Z}
% Examen: Seq[Respuesta]
% Respuesta: Char
% Nota: Z

\obs{aula}{Aula}
\\
\obs{solucion}{Examen}
\\
\obs{entregas}{\conj{Alumno}}

\subsection{proc EdR}
% Metodo EdR --------------------------------------------------

\begin{proc}{EdR}
{
\In dimensionAula: \Z,
\In s: Examen,
\In cantEstudiantes: \Z
}{
\Tipo{EdR}
}
    \requiereLargo{
    dimensionAula > 0 \yLuego
    \\ rtaValida(s) \yLuego
    \\ cantValidaEstudiantes(dimensionAula, cantEstudiantes)}
    \aseguraLargo{
    \norm{res.aula} = dimensionAula \yLuego
    \\ aulaCuadrada(res.aula) \yLuego
    \\ cuantosEstudiantes(res.aula) = cantEstudiantes \yLuego
    \\ examenesInicializados(res.aula, s) \yLuego
    \\ noHayAlumnosJuntos(res.aula) \yLuego
    \\ todosAlumnosConCoordenada(res.aula) \yLuego
    \\ res.solucion = s \yLuego 
    \\ res.entregas = \conj{}}
\end{proc}

% Todos los espacios en el aula tienen su coordenada en el struct
\predLargo{todosAlumnosConCoordenada}{a: aula}{
    \paraTodo{c1}{Coordenada}{coordenadaValida(c1,a) \implicaLuego
    \\(a[c1.f][c1.c].coord.f = c1.f \land a[c1.f][c1.c].coord.c = c1.c)}
}
\\ \\
% Las respuestas del examen estan en el rango de opciones
\predLargo{rtaValida}{s: Examen}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{s} \implicaLuego 0 \leq s[i] \leq 9}
}

% si c y f estan entre las dimensiones de aula la coordenada es valida 
\predLargo{coordenadaValida}{coord:Coordenada, a:Aula}{0 \leq coord.f < \norm{a} \land 0 \leq coord.c < \norm{a}}
\\
\predLargo{cantValidaEstudiantes}{a, c: \Z}{
    (0 \leq c \leq ifThenElse(mod(a,2)=0, \frac{a^ 2}{2}, \frac{a^ 2 + a}{2}))    
}
Chequea que la cantidad de estudiantes sea menor o igual a los que entran en el aula manteniendo la separación de al menos 1 asiento entre cada uno \\

% el aula tiene misma cantidad de filas y columnas
\predLargo{aulaCuadrada}{a: Aula}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{a} \implicaLuego \norm{a[i]} = \norm{a}}
}

% si hay un alumno en el asiento entonces, el que le sigue tiene que ser vacio
\predLargo{noHayAlumnosJuntos}{a: Aula}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{a} \implicaLuego 
    \\ \paraTodo{j}{\Z}{(0 \leq j < \norm{a[i]}-1 \yLuego a[i][j].examen \neq \langle \rangle) \implicaLuego a[i][j+1].examen = \langle \rangle}}
}

% cuantos estudiantes hay en el aula
\aux{cuantosEstudiantes}{a: Aula}{\Z} \\
    $\sum_{i=0}^{\norm{a}-1} \sum_{j=0}^{\norm{a[i]}-1} ifThenElse(a[i][j].examen \neq \langle \rangle,1,0)$
\\

% todos los examenes en el aula estan sin responder y son del largo correcto
\predLargo{examenesInicializados}{a: Aula, sol: Examen}{
    \paraTodo{c1}{Coordenada}{(coordenadaValida(c1, a) \yLuego suExamen(c1, a) \neq \langle \rangle) \implicaLuego 
    \\ examenInicializado(a[c1.f][c1.c].examen, sol)}
}

% El examen no tiene ninguna respuesta
\predLargo{examenInicializado}{e: Examen, sol: Examen}{
    \norm{e} = \norm{sol} \yLuego
    \paraTodo{i}{\Z}{0 \leq i < \norm{e} \implicaLuego e[i] = -1}
}

\subsection{proc igualdad}
% Metodo igualdad --------------------------------------------------
\begin{proc}{igualdad}
{
\In edr_1,edr_2: EdR,
}{
\Tipo{Bool}
}
    \requiere{True}
    \aseguraLargo{res = True \leftrightarrow
    \\ (edr_1.aula = edr_2.aula \land
    \\ edr_1.solucion = edr_2.solucion \land
    \\ edr_1.entregas = edr_2.entregas)
    }
\end{proc}

\subsection{proc copiarse}
% Metodo copiarse --------------------------------------------------

% CAMBIAR EL METODO COPIARSE YA QUE NO EXISTE MAS ultimoPasoExamen()

\begin{proc}{copiarse}
{
\In a1: Alumno,
\Inout edr: EdR 
}{
\Tipo{}
}
    \requiereLargo{ 
        perteneceAlumno(a1, edr.aula) \yLuego\\
        \existe{i}{\Z}{0\leq i < \norm{a1.examen}\yLuego \existe{a2}{alumno}{\\
        perteneceAlumno(a2, edr.aula)\ \yLuego\\
        (puedeCopiarse(a1.coord, a2.coord, edr.aula) \land\\
        suExamen(a1.coord, edr.aula)[i] = -1 \land\\
        suExamen(a2.coord, edr.aula)[i] \neq -1)}}\yLuego
        \\(edr_0 = edr)
    }
    \aseguraLargo{
        \existe{i}{\Z}{0\leq i < \norm{a1.examen}\yLuego \existe{a2}{alumno}{\\
            perteneceAlumno(a2, edr_0.aula) \yLuego \\
            (puedeCopiarse(a1.coord, a2.coord, edr_0.aula)\land\\
            suExamen(a1.coord, edr_0.aula)[i]= -1 \land \\
            suExamen(a2.coord, edr_0.aula)[i] \neq -1 \land\\
            suExamen(a1.coord, edr.aula)[i] = suExamen(a2.coord, edr.aula)[i]\land\\
            mismosEjerciciosMenos(i, suExamen(a1.coord, edr.aula), a1.examen))\\
        }}\yLuego\\
        todosEstudiantesIgualesMenos(\langle a1.coord \rangle ,edr.aula,edr0.aula)\yLuego 
        \\ (edr_0.solucion = edr.solucion) \yLuego
        \\ (edr_0.entregas = edr.entregas)
    } 
\end{proc}
\\

% a1 y a2 tienen la misma norma y son cuadradas
\predLargo{mismasDimensiones}{a1,a2: Aula}{
    \norm{a1}=\norm{a2} \land aulaCuadrada(a1) \land aulaCuadrada(a2)
}

% Las aulas son iguales en todas las coordenadas menos en las especificadas en coords 
\predLargo{todosEstudiantesIgualesMenos}{coords: \seq{Coordenada}, a0, a1: Aula}{
        mismasDimensiones(a0, a1)\land\\ 
        \paraTodo{c1}{Coordenada}{(coordenadaValida(c1, a0) \land \neg(c1 \in coords)) \implicaLuego a1[c1.f][c1.c] = a0[c1.f][c1.c]}
}

% e0 es igual a e1 en todos los ejercicios menos en i
\predLargo{mismosEjerciciosMenos}{i: \Z, e0, e1: Examen}{
    \norm{e1} = \norm{e0} \yLuego\\
    \paraTodo{j}{\Z}{(0 \leq j < \norm{e0} \land j \neq i)
    \implicaLuego e0[j] = e1[j]}
}

% las coordenadas del alumno estan en el aula y el examen es el mismo
\predLargo{perteneceAlumno}{e: Alumno, a:Aula}{
    (coordenadaValida(e.coord, a) \yLuego suExamen(e.coord, a) \neq \langle \rangle \yLuego \\ suExamen(e.cord, a) = e.examen)
}

% las coordenadas estan dentro del aula y c0 esta a distancia |2| de c1 en x o esta directamente adelante en y
\predLargo{puedeCopiarse}{c1, c2: Coordenada, a: Aula}{
    coordenadaValida(c1, a) \land coordenadaValida(c2, a) \land
    \\ ((\norm{c2.c - c1.c} = 2 \land c2.f = c1.f) \lor
    \\ (c2.c = c1.c \land  c2.f - c1.f = 1))
}

% devuelve el examen del alumno en c1
\aux{suExamen}{c1:Coordenada, a: Aula}{Examen} \ $a[c1.f][c1.c].examen$


\subsection{proc consultarDarkWeb}
% Metodo consultarDarkWeb --------------------------------------------------
\begin{proc}{consultarDarkWeb}
{
\In s: Examen,
\In posiblesAccesos: \Z,
\Inout edr: EdR
}{}
    \requiereLargo{
    edr = edr_0 \yLuego
    \\rtaValida(s) \yLuego
    \\\norm{s} = \norm{edr.solucion} \yLuego
    \\posiblesAccesos \geq 0
    }
    \aseguraLargo{
    \existe {n}{\Z}{0 \leq n \leq posiblesAccesos \land 0 \leq n \leq cuantosEstudiantes(edr.aula)} \land
    \\ \existe {seCopian}{\seq{Coordenada}}{\norm{seCopian} = n \land 
    \\ \paraTodo{c1}{Coordenada}{c1 \in seCopian \leftrightarrow 
    \\(coordenadaValida(c1,edr_0.aula) \yLuego suExamen(c1, edr_0.aula) \neq \langle \rangle \land
    \\ suExamen(c1,edr.aula) = s)}} \yLuego
    \\todosEstudiantesIgualesMenos(seCopian,edr.aula, edr_0.aula) \yLuego
    \\edr.solucion = edr_0.solucion \yLuego
    \\edr.entregas = edr_0.entregas
}
\end{proc}
\subsection{proc resolver}
% Metodo resolver --------------------------------------------------
\begin{proc}{resolver}
{
\Inout edr: EdR,
\Inout a: Alumno,
\In e: \seq{Examen}
}{
\Tipo{\seq{Examen}}
}
    \requiereLargo{
    perteneceAlumno(a, edr.aula)\yLuego\\
    examenInicializado(a.examen, edr.solucion)\yLuego\\
    \norm{e} > 0 \yLuego\\
    edr_0 = edr \yLuego\\
    a_0 = a
    }
    \aseguraLargo{
        % vv el examen q devolvemos tiene t+1 pasos
        \norm{res} = \norm{e} + 1\yLuego\\
        % aca me aseguro que en el paso t+1 resuelvo un ejercicio que en el paso t no estaba resuelto vv
        hayNuevoEjercicioResuelto(e[\norm{e}-1], a.examen)\land\\
        % vv aca me fijo que el resto de pasos esten igual
        res = e ++ \langle a.examen\rangle \yLuego\\
        % vv igualo el examen en edr con el examen q devuelvo
        edr.aula[a.coord.f][a.coord.c] = a\yLuego\\
        % vv Todo el resto sigue igual
        todosEstudiantesIgualesMenos(\langle a.coord \rangle, edr.aula, edr_0.aula)\yLuego\\ 
        edr_0.solucion = edr.solucion \yLuego\\
        edr_0.entregas = edr.entregas
    }
\end{proc}

% existe solo 1 ejercicio con respuesta nueva en e1 que en e0 no estaba
\predLargo{hayNuevoEjercicioResuelto}{e0, e1: Examen}{
        (\exists k: \Z)(0 \leq k < \norm{e0} \yLuego
        mismosEjerciciosMenos(k, e1, e0) \land\\
        \lnot respondio(k, e0) \land
        respondio(k, e1))
}

% el ejercicio i del examen fue resuelto
\predLargo{respondio}{i: \Z, e: Examen}{
    (0 \leq i < \norm{e}) \yLuego e[i] \neq ""
}

\subsection{proc entregar}
% Metodo entregar --------------------------------------------------
\begin{proc}{entregar}
{
\In a: Alumno,
\Inout edr: EdR
}{
}
    \requiereLargo{
        (perteneceAlumno(a, edr.Aula)) \yLuego
        \\ (edr = edr_0)
    } 
    \aseguraLargo{
        % CAMBIO EL a.examen, ANTES REVISABA EL ULTIMO PASO
        (edr.entregas = edr_0.entregas \cup \conj{a}) \yLuego
        \\ (suExamen(a.coord, edr.aula) = \langle \rangle) \yLuego
        \\ (todosEstudiantesIgualesMenos(\langle a.coord \rangle,edr,edr_0)) \yLuego
        \\ (edr.solucion = edr_0.solucion)
    }
\end{proc}

\subsection{proc chequearCopias}
% Metodo chequearCopias --------------------------------------------------
\begin{proc}{chequearCopias}
{
\In edr: EdR
}{
\Tipo{\seq{Alumno}}
}
    \requiere{todosEntregaron(edr)} 
    \asegura{
        \paraTodo {a1}{Alumno}{a1 \in edr.entregas \implicaLuego (a1 \in res \leftrightarrow esSospechoso(a1))}
        }
\end{proc}
\\

% devuelve el porcentaje de respuestas iguales entre 2 alumnos
\aux{porcentajeRespuestasIgualAdyacente}{a1, a2: Alumno}{\Z}
\\    $(\sum_{i=0}^{\norm{a1.examen}-1} IfThenElse((a1.examen[i] = a2.examen[i]),1,0)) \cdot \frac{100}{\norm{a1.examen}}$
\\

% devuelve el porcentaje de alumnos que tienen el mismo examen que a1 en una secuencia
\aux{porcentajeIgualAula}{a:Alumno, entregas:\conj{Alumno}}{\Z}
\\ $(\sum_{i \in entregas}IfThenElse( a \neq i\land a.examen = i.examen,1,0)) \cdot \frac{100}{\norm{entregas}-1}$
\\

% No queda ningun estudiante en el aula
\predLargo{todosEntregaron}{edr: EdR}{
    \norm{edr.entregas} > 0 \land \paraTodo{c1}{Coordenada}{coordenadaValida(c1,edr.aula) \implicaLuego 
    \\ suExamen(c1, edr.aula) = \langle \rangle}
}

\predLargo{esSospechoso}{edr: EdR, a1: Alumno}{
    \existe{a2}{Alumno}{a2 \in edr.entregas  \land  puedeCopiarse(a1.coord, a2.coord, edr.aula) \land 
    \\ porcentajeRespuestasIgualAdyacente(a1, a2) > 60} \ \lor \\porcentajeIgualAula(a1, edr.entregas) > 25
}

\subsection{proc corregir}
% Metodo corregir --------------------------------------------------
\begin{proc}{corregir} 
{
\In edr:EdR
}{
\Tipo{\seq{tupla\tupla{Alumno, Nota}}}
}
    \requiere{todosEntregaron(edr)}
    \aseguraLargo{
        % aca uso es si y solo si para que solo tenga esos elementos
        \paraTodo{a}{Alumno}{(a \in edr.entregas \land \lnot esSospechoso(edr, a)) \leftrightarrow\\
        tupla\tupla{a, nota(a, edr.solucion)} \in res}\yLuego
        % me fijo que la tupla este una sola vez
        noRepetidos(res)
}
\end{proc}

\predLargo{noRepetidos}{s: \seq{tupla\tupla{Alumno, Nota}}}{
    \paraTodo{i, j}{\Z}{0 \leq i < \norm{res} \land 0 \leq j < \norm{res} \implicaLuego (res[i] = res[j] \leftrightarrow i = j)}
}

% Suma todas las respuestas correctas, lo divide por la cantidad de respuestas y lo multiplica por 10 (standar)
\aux{nota}{a: Alumno, sol: Examen}{\Z}
    \\ $((\sum_{i=0}^{\norm{sol}-1}ifThenElse(a.examen[i] = sol[i], 1, 0))) \cdot \frac{10}{\norm{sol}}$

\end{tad}

\end{document}
